<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mr Nathan's GCSE Maths Question Bank</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fb;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #ffffff;
      padding: 24px 28px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h1 {
      margin-top: 0;
      font-size: 1.6rem;
      color: #134b9b;
    }
    .subtitle {
      color: #555;
      margin-bottom: 16px;
      font-size: 0.95rem;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
      align-items: center;
    }
    select, button {
      padding: 8px 12px;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #c5cbe0;
      background: #ffffff;
      cursor: pointer;
    }
    button {
      background: #134b9b;
      color: #fff;
      border: none;
    }
    button:hover {
      background: #0f3f84;
    }
    button:disabled{
      background:#9fb2d6;
      cursor:not-allowed;
    }
    .meta {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 8px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .question-text {
      font-size: 1.05rem;
      margin: 12px 0 16px;
      white-space: pre-wrap;
    }
    .options {
      list-style: none;
      padding: 0;
      margin: 0 0 16px;
    }
    .options li {
      margin-bottom: 6px;
      line-height:1.35;
    }
    .option-label {
      display: inline-block;
      width: 20px;
      font-weight: bold;
    }
    .solution {
      border-top: 1px solid #dde3f5;
      margin-top: 12px;
      padding-top: 12px;
      display: none;
      font-size: 0.95rem;
    }
    .solution pre {
      margin: 0;
      white-space: pre-wrap;
      font-family: inherit;
      line-height:1.35;
    }
    .footer-note {
      margin-top: 20px;
      font-size: 0.8rem;
      color: #999;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e7eefe;
      color: #134b9b;
      font-size: 0.75rem;
      margin-right: 0;
    }
    .difficulty {
      font-weight: bold;
    }
    .small-note{
      margin-top:6px;
      color:#666;
      font-size:0.85rem;
      line-height:1.35;
    }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
  <div class="container">
    <h1>Mr Nathan's GCSE Maths Question Bank</h1>
    <div class="subtitle">
      WJEC GCSE Intermediate Tier • Random, regeneratable questions with GCSE-faithful formatting.
    </div>

    <div class="controls">
      <label for="topicSelect">Topic:</label>
      <select id="topicSelect">
        <option value="all">(All topics)</option>
        <option value="Number">Number</option>
        <!-- Future expansion -->
        <option value="Algebra">Algebra</option>
        <option value="Geometry & Measure">Geometry & Measure</option>
        <option value="Statistics & Probability">Statistics & Probability</option>
      </select>

      <button id="newQuestionBtn">New Question</button>
      <button id="showSolutionBtn">Show Solution</button>
      <button id="hideSolutionBtn" disabled>Hide Solution</button>
    </div>

    <div class="meta">
      <span id="topicTag" class="pill"></span>
      <span id="skillTag" class="pill"></span>
      <span class="difficulty">Difficulty: <span id="difficultyText"></span></span>
      <span id="idTag" class="pill" style="margin-left:auto; color:#0f3f84; background:#eef3ff;"></span>
    </div>

    <div class="small-note">
      Formatting enforced: no e-notation, no caret powers, powers shown with GCSE superscripts, standard form shown as <span class="pill">a × 10ⁿ</span> (1 ≤ a &lt; 10) with one decimal place, no recurring decimals, fractions/mixed numbers preferred (unless decimals/money), money as <span class="pill">£x.xx</span>.
    </div>

    <div class="question-text" id="questionText">
      Click “New Question” to begin.
    </div>

    <ul class="options" id="optionsList"></ul>

    <div class="solution" id="solutionBlock">
      <strong>Worked solution</strong>
      <pre id="solutionText"></pre>
    </div>

    <div class="footer-note">
      NUMBER is being made exam-complete first. Other strands will be added after NUMBER is complete.
    </div>
  </div>

<script>
/* =========================
   Core utilities
   ========================= */

function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function choice(arr){ return arr[randInt(0, arr.length - 1)]; }
function shuffleArray(arr) {
  const copy = arr.slice();
  for (let i = copy.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy;
}
function gcd(a, b){
  a = Math.abs(a); b = Math.abs(b);
  while(b !== 0){ const t = a % b; a = b; b = t; }
  return a;
}

/* Superscripts (no caret powers) */
const SUP = { "0":"⁰","1":"¹","2":"²","3":"³","4":"⁴","5":"⁵","6":"⁶","7":"⁷","8":"⁸","9":"⁹","-":"⁻" };
function toSuperscript(n){
  return String(n).split("").map(ch => SUP[ch] ?? ch).join("");
}

/* Fractions (no recurring decimals; show as fraction/mixed number) */
class Fraction {
  constructor(n, d=1){
    if(d === 0) throw new Error("Denominator 0");
    if(d < 0){ n = -n; d = -d; }
    const g = gcd(n, d);
    this.n = n / g;
    this.d = d / g;
  }
  add(o){ return new Fraction(this.n*o.d + o.n*this.d, this.d*o.d); }
  sub(o){ return new Fraction(this.n*o.d - o.n*this.d, this.d*o.d); }
  mul(o){ return new Fraction(this.n*o.n, this.d*o.d); }
  div(o){ return new Fraction(this.n*o.d, this.d*o.n); }
  toMixedString(){
    if(this.n === 0) return "0";
    const neg = this.n < 0;
    const an = Math.abs(this.n);
    const whole = Math.floor(an / this.d);
    const rem = an % this.d;
    if(rem === 0) return (neg ? "-" : "") + String(whole);
    if(whole === 0) return (neg ? "-" : "") + `${rem}/${this.d}`;
    return (neg ? "-" : "") + `${whole} ${rem}/${this.d}`;
  }
  toFractionString(){
    if(this.d === 1) return String(this.n);
    return `${this.n}/${this.d}`;
  }
}

/* Money formatting: £x.xx */
function moneyFromPence(p){
  const neg = p < 0;
  const ap = Math.abs(p);
  const pounds = Math.floor(ap / 100);
  const pennies = ap % 100;
  return (neg ? "-" : "") + "£" + String(pounds) + "." + String(pennies).padStart(2, "0");
}

/* =========================
   Standard form (one decimal coefficient)
   Represent coefficient as integer 'tenths' (10..99) meaning tenths/10
   ========================= */

function normaliseStdForm(tenths, exp){
  if(tenths === 0) return { tenths: 0, exp: 0 };

  while(tenths >= 100){
    tenths = Math.round(tenths / 10);
    exp += 1;
  }
  while(tenths < 10){
    tenths *= 10;
    exp -= 1;
  }
  // guard after rounding
  if(tenths >= 100){
    tenths = Math.round(tenths / 10);
    exp += 1;
  }
  if(tenths < 10){
    tenths *= 10;
    exp -= 1;
  }
  return { tenths, exp };
}

function stdFormToString(tenths, exp){
  const a = (tenths / 10).toFixed(1);
  return `${a} × 10${toSuperscript(exp)}`;
}

function multiplyStdForm(a1, e1, a2, e2){
  let tenths = a1 * a2;     // tenths/10 * tenths/10 => /100; handled by exponent shift
  let exp = e1 + e2 - 1;    // shift due to /10 factor
  return normaliseStdForm(tenths, exp);
}

function divideStdForm(a1, e1, a2, e2){
  // Choose friendly numbers so (a1*10) divisible by a2 (exact one decimal coefficient)
  const expBase = e1 - e2;
  const num = a1 * 10;
  if(num % a2 !== 0) throw new Error("Avoid non-terminating division");
  let tenths = num / a2;
  let exp = expBase - 1;
  return normaliseStdForm(tenths, exp);
}

/* =========================
   IDs
   ========================= */
function makeID(prefix){
  const t = Date.now().toString(36).slice(-6);
  const r = Math.random().toString(36).slice(2,6);
  return `${prefix}-${t}-${r}`.toUpperCase();
}

/* =========================
   NUMBER generators (exam-complete build)
   Each returns: {topic, skill, difficulty, question, options, correctIndex, solution, id}
   ========================= */

function makeMCQFromCorrectAndWrongs(correct, wrongs, formatter){
  // Ensure unique values (string compare after formatting)
  const seen = new Set();
  const all = [{v: correct, isCorrect:true}];
  for(const w of wrongs){ all.push({v:w, isCorrect:false}); }
  const formatted = [];
  for(const item of all){
    const txt = formatter(item.v);
    if(!seen.has(txt)){
      seen.add(txt);
      formatted.push({ txt, isCorrect:item.isCorrect });
    }
  }
  // If uniqueness collapsed, caller should regenerate
  if(formatted.length < 4) return null;

  const shuffled = shuffleArray(formatted).slice(0,4);
  const correctIndex = shuffled.findIndex(x => x.isCorrect);
  const options = shuffled.map(x => x.txt);
  return { options, correctIndex };
}

/* Reverse percentages (money) */
function makeReversePercentMoney(){
  const kind = choice(["increased", "reduced"]);
  const pct = choice([5,10,20,25,50]);
  const mult = (kind === "increased") ? (100 + pct) : (100 - pct);

  // choose original pence so final pence is exact
  const originalPence = mult * choice([120,150,180,200,250,300,350,400,450]);
  const finalPence = (originalPence * mult) / 100;

  const question = `A price is ${kind} by ${pct}% and becomes ${moneyFromPence(finalPence)}.\nWhat was the original price?`;

  const correct = originalPence;

  // distractors (common errors)
  const wrong1 = (finalPence * mult) / 100; // applying change again
  const wrong2 = kind === "increased"
    ? (finalPence * 100) / (100 - pct)       // used wrong multiplier
    : (finalPence * 100) / (100 + pct);
  const wrong3 = finalPence;                 // assumes original = final

  // ensure integers
  if(!Number.isInteger(wrong1) || !Number.isInteger(wrong2)) return makeReversePercentMoney();

  const mcq = makeMCQFromCorrectAndWrongs(
    correct,
    [wrong1, wrong2, wrong3],
    (p) => moneyFromPence(p)
  );
  if(!mcq) return makeReversePercentMoney();

  const solution =
`Final price = original × ${mult}/100
So original = final × 100/${mult}
Original = ${moneyFromPence(finalPence)} × 100/${mult} = ${moneyFromPence(originalPence)}`;

  return {
    id: makeID("REV%M"),
    topic: "Number",
    skill: "Reverse percentages",
    difficulty: "Intermediate",
    question,
    options: mcq.options,
    correctIndex: mcq.correctIndex,
    solution
  };
}

/* Reverse percentages (non-money) */
function makeReversePercentNumber(){
  const pct = choice([10,20,25,50]);
  const kind = choice(["increased", "decreased"]);
  const mult = (kind === "increased") ? (100 + pct) : (100 - pct);

  const original = mult * choice([2,3,4,5,6,8,10,12]);
  const finalVal = (original * mult) / 100;

  const question = `A number is ${kind} by ${pct}% and becomes ${finalVal}.\nWhat was the original number?`;

  const correct = original;
  const wrong1 = finalVal;
  const wrong2 = (finalVal * mult) / 100;
  const wrong3 = (finalVal * 100) / (kind === "increased" ? (100 - pct) : (100 + pct));

  if(!Number.isInteger(wrong2) || !Number.isInteger(wrong3)) return makeReversePercentNumber();

  const mcq = makeMCQFromCorrectAndWrongs(
    correct,
    [wrong1, wrong2, wrong3],
    (x) => String(x)
  );
  if(!mcq) return makeReversePercentNumber();

  const solution =
`Final value = original × ${mult}/100
So original = final × 100/${mult}
Original = ${finalVal} × 100/${mult} = ${original}`;

  return {
    id: makeID("REV%N"),
    topic: "Number",
    skill: "Reverse percentages",
    difficulty: "Intermediate",
    question,
    options: mcq.options,
    correctIndex: mcq.correctIndex,
    solution
  };
}

/* Percentage change (find percent change, find new value, find original) */
function makePercentageChange(){
  const mode = choice(["find-percent-change","find-new-after-change","find-old-given-change"]);

  if(mode === "find-percent-change"){
    const oldVal = choice([40,50,60,80,100,120,150,200]);
    const change = choice([5,10,15,20,25,30,40,50]);
    const dir = choice(["increase","decrease"]);
    const newVal = dir === "increase" ? oldVal + change : oldVal - change;

    if((change*100) % oldVal !== 0) return makePercentageChange();
    const pct = (change*100) / oldVal;

    const question = `A value changes from ${oldVal} to ${newVal}.\nWhat is the percentage ${dir}?`;

    const correct = pct;
    const wrong1 = (change*100) / newVal; // used new as base
    const wrong2 = change;                // forgot ×100/old
    const wrong3 = (oldVal*100) / change; // inverted

    if(!Number.isInteger(wrong1) || !Number.isInteger(wrong3)) return makePercentageChange();

    const mcq = makeMCQFromCorrectAndWrongs(
      correct,
      [wrong1, wrong2, wrong3],
      (x) => `${x}%`
    );
    if(!mcq) return makePercentageChange();

    const solution =
`Change = ${newVal} − ${oldVal} = ${change}
Percentage change = (change ÷ original) × 100
= (${change} ÷ ${oldVal}) × 100 = ${pct}%`;

    return {
      id: makeID("PCHG"),
      topic: "Number",
      skill: "Percentage change",
      difficulty: "Intermediate",
      question,
      options: mcq.options,
      correctIndex: mcq.correctIndex,
      solution
    };
  }

  if(mode === "find-new-after-change"){
    const oldVal = choice([60,80,100,120,150,200,250]);
    const pct = choice([5,10,12,15,20,25,30,40]);
    const dir = choice(["increase","decrease"]);
    const mult = dir === "increase" ? (100 + pct) : (100 - pct);

    if((oldVal * mult) % 100 !== 0) return makePercentageChange();
    const newVal = (oldVal * mult) / 100;

    const question = `A value of ${oldVal} is ${dir}d by ${pct}%.\nWhat is the new value?`;

    const correct = newVal;
    const wrong1 = oldVal + pct; // added percent as a number
    const wrong2 = dir === "increase" ? (oldVal * (100 - pct)) / 100 : (oldVal * (100 + pct)) / 100;
    const wrong3 = oldVal + (oldVal * pct); // forgot ÷100

    if(!Number.isInteger(wrong2) || !Number.isInteger(wrong3)) return makePercentageChange();

    const mcq = makeMCQFromCorrectAndWrongs(
      correct,
      [wrong1, wrong2, wrong3],
      (x) => String(x)
    );
    if(!mcq) return makePercentageChange();

    const solution =
`Multiplier = ${mult}/100
New value = ${oldVal} × ${mult}/100 = ${newVal}`;

    return {
      id: makeID("PCHG"),
      topic: "Number",
      skill: "Percentage change",
      difficulty: "Intermediate",
      question,
      options: mcq.options,
      correctIndex: mcq.correctIndex,
      solution
    };
  }

  // find original given final and change
  const pct = choice([10,20,25,50]);
  const dir = choice(["increase","decrease"]);
  const mult = dir === "increase" ? (100 + pct) : (100 - pct);

  const original = mult * choice([2,3,4,5,6,8,10]);
  const finalVal = (original * mult) / 100;

  const question = `After a ${pct}% ${dir}, the value becomes ${finalVal}.\nWhat was the value before the change?`;

  const correct = original;
  const wrong1 = finalVal;
  const wrong2 = (finalVal * mult) / 100; // applied again
  const wrong3 = (finalVal * 100) / (dir === "increase" ? (100 - pct) : (100 + pct)); // wrong reverse

  if(!Number.isInteger(wrong2) || !Number.isInteger(wrong3)) return makePercentageChange();

  const mcq = makeMCQFromCorrectAndWrongs(
    correct,
    [wrong1, wrong2, wrong3],
    (x) => String(x)
  );
  if(!mcq) return makePercentageChange();

  const solution =
`Final = original × ${mult}/100
Original = final × 100/${mult}
= ${finalVal} × 100/${mult} = ${original}`;

  return {
    id: makeID("PCHG"),
    topic: "Number",
    skill: "Percentage change",
    difficulty: "Intermediate",
    question,
    options: mcq.options,
    correctIndex: mcq.correctIndex,
    solution
  };
}

/* Ratio simplification */
function makeRatioSimplify(){
  const k = choice([2,3,4,5,6,7,8,9,10,12]);
  const a = k * choice([2,3,4,5,6]);
  const b = k * choice([3,4,5,6,7]);
  const g = gcd(a,b);

  const question = `Simplify the ratio ${a} : ${b}.`;
  const correct = `${a/g} : ${b/g}`;
  const wrong1 = `${a} : ${b}`;          // not simplified
  const wrong2 = `${a/g} : ${b}`;        // only simplified one side
  const wrong3 = `${a} : ${b/g}`;        // only simplified other side

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  const correctIndex = answers.indexOf(correct);

  const solution =
`Highest common factor of ${a} and ${b} is ${g}.
Divide both parts by ${g}:
${a} : ${b} = ${a/g} : ${b/g}`;

  return {
    id: makeID("RATIO"),
    topic: "Number",
    skill: "Ratio simplification",
    difficulty: "Foundation / Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Best buy (unit pricing) */
function makeBestBuy(){
  const item = choice([
    {name:"rice", unit:"g"},
    {name:"coffee", unit:"g"},
    {name:"orange juice", unit:"ml"},
    {name:"washing powder", unit:"g"}
  ]);

  const sizeA = choice([250,400,500,750,1000]);
  const sizeB = choice([300,450,600,900,1200]);
  const priceA = randInt(150, 650); // pence
  const priceB = randInt(180, 720); // pence

  const scale = 100; // per 100g/ml

  if((priceA * scale) % sizeA !== 0) return makeBestBuy();
  if((priceB * scale) % sizeB !== 0) return makeBestBuy();

  const unitA = (priceA * scale) / sizeA; // pence per 100 units
  const unitB = (priceB * scale) / sizeB;

  if(unitA === unitB) return makeBestBuy();

  const question =
`Best buy:
A) ${sizeA}${item.unit} of ${item.name} for ${moneyFromPence(priceA)}
B) ${sizeB}${item.unit} of ${item.name} for ${moneyFromPence(priceB)}
Which is better value?`;

  const correct = unitA < unitB ? "A" : "B";
  const wrongs = ["A","B"].filter(x => x !== correct);
  // Provide 4 MCQ options as labels; include two obvious distractors as “Neither” / “Same value”
  const options = shuffleArray([correct, wrongs[0], "Same value", "Neither"]).slice(0,4);
  const correctIndex = options.indexOf(correct);

  const solution =
`Compare the cost per ${scale}${item.unit}.
A: (${moneyFromPence(priceA)} ÷ ${sizeA}${item.unit}) × ${scale} = ${moneyFromPence(unitA)} per ${scale}${item.unit}
B: (${moneyFromPence(priceB)} ÷ ${sizeB}${item.unit}) × ${scale} = ${moneyFromPence(unitB)} per ${scale}${item.unit}
So the better value is option ${correct}.`;

  return {
    id: makeID("BEST"),
    topic: "Number",
    skill: "Best buy / unit pricing",
    difficulty: "Intermediate",
    question,
    options,
    correctIndex,
    solution
  };
}

/* Fraction add/subtract */
function makeFractionAddSub(){
  const op = choice(["+","−"]);
  const d1 = choice([4,5,6,8,10,12]);
  const d2 = choice([3,4,6,8,9,12]);
  const n1 = randInt(1, d1-1);
  const n2 = randInt(1, d2-1);

  const f1 = new Fraction(n1, d1);
  const f2 = new Fraction(n2, d2);
  const res = (op === "+") ? f1.add(f2) : f1.sub(f2);

  if(res.n <= 0) return makeFractionAddSub();

  const correct = res.toMixedString();

  // distractors
  const wrong1 = (op === "+") ? new Fraction(n1+n2, Math.max(d1,d2)).toMixedString() : new Fraction(Math.abs(n1-n2), Math.max(d1,d2)).toMixedString(); // add/sub numerators wrongly
  const wrong2 = (op === "+") ? new Fraction(n1+n2, d1+d2).toMixedString() : new Fraction(Math.abs(n1-n2), d1+d2).toMixedString(); // add denominators wrongly
  const wrong3 = (op === "+") ? new Fraction(n1*d2 + n2*d1, d1*d2).toMixedString() : new Fraction(Math.abs(n1*d2 - n2*d1), d1*d2).toMixedString(); // same as correct but absolute (for subtraction)

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]).slice(0,4);
  // if duplicates, regen
  if(new Set(answers).size < 4) return makeFractionAddSub();

  const correctIndex = answers.indexOf(correct);

  const question = `Work out: ${n1}/${d1} ${op} ${n2}/${d2}\nGive your answer in its simplest form.`;

  const solution =
`Find a common denominator:
${n1}/${d1} ${op} ${n2}/${d2}
= ${(n1*(d2/gcd(d1,d2)))}/${(d1*(d2/gcd(d1,d2)))} ${op} ${(n2*(d1/gcd(d1,d2)))}/${(d2*(d1/gcd(d1,d2)))}
Then combine and simplify.
Answer = ${correct}.`;

  return {
    id: makeID("FRAC"),
    topic: "Number",
    skill: "Fractions (add/subtract)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Fraction of an amount */
function makeFractionOfAmount(){
  const frac = choice([new Fraction(3,4), new Fraction(2,3), new Fraction(5,6), new Fraction(7,8), new Fraction(3,5)]);
  const base = choice([24,36,48,56,60,72,80,90,96,120]);

  if((base * frac.n) % frac.d !== 0) return makeFractionOfAmount();
  const ans = (base * frac.n) / frac.d;

  const question = `Find ${frac.toFractionString()} of ${base}.`;
  const correct = String(ans);
  const wrong1 = String(base * frac.n);             // forgot ÷ denominator
  const wrong2 = String(base / frac.n);             // divided by numerator
  const wrong3 = String(base / frac.d);             // did only denominator part

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeFractionOfAmount();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Multiply by the numerator and divide by the denominator:
${frac.toFractionString()} of ${base} = ${base} × ${frac.n}/${frac.d}
= (${base} ÷ ${frac.d}) × ${frac.n} = ${ans}.`;

  return {
    id: makeID("FRAC"),
    topic: "Number",
    skill: "Fractions of an amount",
    difficulty: "Foundation / Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Indices evaluate */
function makeIndicesEvaluate(){
  const base = choice([2,3,4,5,6,7,8,9,10]);
  const power = choice([2,3,4,5]);
  const value = Math.pow(base, power);

  const question = `Evaluate: ${base}${toSuperscript(power)}`;

  const correct = String(value);
  const wrong1 = String(base * power);         // multiplied instead of power
  const wrong2 = String(base + power);         // added
  const wrong3 = String(value - base);         // off-by-base

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeIndicesEvaluate();
  const correctIndex = answers.indexOf(correct);

  const solution =
`${base}${toSuperscript(power)} means ${base} multiplied by itself ${power} times.
So ${base}${toSuperscript(power)} = ${value}.`;

  return {
    id: makeID("IDX"),
    topic: "Number",
    skill: "Powers / indices",
    difficulty: "Foundation / Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Mean (integer mean to avoid recurring decimals) */
function makeMeanInteger(){
  const count = choice([4,5,6]);
  const mean = choice([7,8,9,10,11,12,13]);
  const total = mean * count;

  // create values summing to total and within 1..20
  let nums = [];
  let remaining = total;
  for(let i=0;i<count-1;i++){
    const maxHere = Math.min(20, remaining - (count-1-i));
    const v = randInt(1, Math.max(1, maxHere));
    nums.push(v);
    remaining -= v;
  }
  nums.push(remaining);
  nums = shuffleArray(nums);
  if(nums.some(n => n < 1 || n > 20)) return makeMeanInteger();

  const question = `The marks are: ${nums.join(", ")}.\nWhat is the mean?`;

  const correct = String(mean);
  const wrong1 = String(total);           // forgot ÷ count
  const wrong2 = String(nums[0]);
  const wrong3 = String(nums[nums.length - 1]);

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeMeanInteger();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Sum = ${nums.join(" + ")} = ${total}
Number of values = ${count}
Mean = ${total} ÷ ${count} = ${mean}.`;

  return {
    id: makeID("MEAN"),
    topic: "Number",
    skill: "Mean (no recurring decimals)",
    difficulty: "Foundation / Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Standard form conversion (ordinary -> standard form, one decimal coefficient) */
function makeStdFormConvert(){
  const exp = randInt(1, 7);
  const coeffTenths = choice([10,12,15,18,20,25,30,35,40,45,50,60,75,90,99]);
  const ordinary = coeffTenths * Math.pow(10, exp-1);

  const question = `Write ${ordinary} in standard form.`;
  const correct = stdFormToString(coeffTenths, exp);

  const wrong1 = `${(coeffTenths/10).toFixed(1)} × 10${toSuperscript(exp-1)}`; // wrong exponent
  const wrong2 = `${(coeffTenths/10).toFixed(1)} × 10${toSuperscript(exp+1)}`; // wrong exponent
  const wrong3 = `${(coeffTenths).toFixed(1)} × 10${toSuperscript(exp)}`;      // coefficient not in range

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeStdFormConvert();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Move the decimal point so the number is between 1 and 10.
${ordinary} = ${correct}.`;

  return {
    id: makeID("SF"),
    topic: "Number",
    skill: "Standard form (convert)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Standard form multiply */
function makeStdFormMultiply(){
  const a1 = choice([12,15,18,20,25,30,35,40,45,50,60,75,90]);
  const a2 = choice([12,15,18,20,25,30,40,50,60,75]);
  const e1 = randInt(-3, 5);
  const e2 = randInt(-3, 5);

  const left = stdFormToString(a1, e1);
  const right = stdFormToString(a2, e2);

  const prod = multiplyStdForm(a1, e1, a2, e2);
  const correct = stdFormToString(prod.tenths, prod.exp);

  const question = `Work out:\n(${left}) × (${right})\nGive your answer in standard form.`;

  const wrong1 = stdFormToString(prod.tenths, prod.exp + 1); // exponent off
  const wrong2 = stdFormToString(prod.tenths, prod.exp - 1);
  const wrong3 = `${(prod.tenths).toFixed(1)} × 10${toSuperscript(prod.exp)}`; // coefficient wrong range

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeStdFormMultiply();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Multiply the numbers and add the powers of 10:
${left} × ${right} = ${correct}.`;

  return {
    id: makeID("SF×"),
    topic: "Number",
    skill: "Standard form (multiply)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Standard form divide */
function makeStdFormDivide(){
  const a2 = choice([12,15,20,25,30,40,50,60,75]);
  let a1 = choice([12,15,18,20,24,25,30,36,40,45,50,60,75,80,90]);

  let tries = 0;
  while(((a1*10) % a2) !== 0 && tries < 25){
    a1 = choice([12,15,18,20,24,25,30,36,40,45,50,60,75,80,90]);
    tries++;
  }
  if(((a1*10) % a2) !== 0) return makeStdFormDivide();

  const e1 = randInt(-2, 6);
  const e2 = randInt(-2, 6);

  const left = stdFormToString(a1, e1);
  const right = stdFormToString(a2, e2);

  let res;
  try{
    res = divideStdForm(a1, e1, a2, e2);
  }catch(e){
    return makeStdFormDivide();
  }
  const correct = stdFormToString(res.tenths, res.exp);

  const question = `Work out:\n(${left}) ÷ (${right})\nGive your answer in standard form.`;

  const wrong1 = stdFormToString(res.tenths, res.exp + 1);
  const wrong2 = stdFormToString(res.tenths, res.exp - 1);
  const wrong3 = `${(res.tenths).toFixed(1)} × 10${toSuperscript(res.exp)}`;

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeStdFormDivide();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Divide the numbers and subtract the powers of 10:
${left} ÷ ${right} = ${correct}.`;

  return {
    id: makeID("SF÷"),
    topic: "Number",
    skill: "Standard form (divide)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Bounds: error intervals */
function makeBoundsErrorInterval(){
  const type = choice(["1dp","nearest cm","nearest 10"]);

  if(type === "1dp"){
    const x = choice([12.3, 4.7, 8.1, 15.6, 20.0, 9.9]);
    const tenths = Math.round(x * 10);
    const low = (tenths - 0.5) / 10;
    const high = (tenths + 0.5) / 10;

    const question = `A length is given as ${x.toFixed(1)} cm, correct to 1 decimal place.\nWrite the error interval for the length, L.`;

    const correct = `${low} ≤ L < ${high}`;
    const wrong1 = `${low} < L < ${high}`;      // wrong inclusivity
    const wrong2 = `${low} ≤ L ≤ ${high}`;      // wrong upper bound inclusive
    const wrong3 = `${(tenths/10).toFixed(1)} − 0.5 ≤ L < ${(tenths/10).toFixed(1)} + 0.5`; // used 0.5 not 0.05

    const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
    if(new Set(answers).size < 4) return makeBoundsErrorInterval();
    const correctIndex = answers.indexOf(correct);

    const solution =
`Correct to 1 decimal place means the half-step is 0.05.
So ${x.toFixed(1)} represents values from ${low} up to (but not including) ${high}.
${correct}`;

    return {
      id: makeID("BND"),
      topic: "Number",
      skill: "Bounds (error interval)",
      difficulty: "Intermediate",
      question,
      options: answers,
      correctIndex,
      solution
    };
  }

  if(type === "nearest cm"){
    const cm = choice([24, 35, 48, 63, 80, 92]);
    const low = cm - 0.5;
    const high = cm + 0.5;

    const question = `A length is given as ${cm} cm, correct to the nearest centimetre.\nWrite the error interval for the length, L.`;

    const correct = `${low} ≤ L < ${high}`;
    const wrong1 = `${low} < L < ${high}`;
    const wrong2 = `${low} ≤ L ≤ ${high}`;
    const wrong3 = `${cm - 1} ≤ L < ${cm + 1}`;

    const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
    if(new Set(answers).size < 4) return makeBoundsErrorInterval();
    const correctIndex = answers.indexOf(correct);

    const solution =
`Nearest cm means the half-step is 0.5 cm.
So ${cm} cm represents values from ${low} up to (but not including) ${high}.
${correct}`;

    return {
      id: makeID("BND"),
      topic: "Number",
      skill: "Bounds (error interval)",
      difficulty: "Intermediate",
      question,
      options: answers,
      correctIndex,
      solution
    };
  }

  // nearest 10
  const n = choice([120, 350, 680, 910, 1040]);
  const low = n - 5;
  const high = n + 5;

  const question = `A number is given as ${n}, correct to the nearest 10.\nWrite the error interval for the number, x.`;

  const correct = `${low} ≤ x < ${high}`;
  const wrong1 = `${low} < x < ${high}`;
  const wrong2 = `${low} ≤ x ≤ ${high}`;
  const wrong3 = `${n - 10} ≤ x < ${n + 10}`;

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeBoundsErrorInterval();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Nearest 10 means the half-step is 5.
So ${n} represents values from ${low} up to (but not including) ${high}.
${correct}`;

  return {
    id: makeID("BND"),
    topic: "Number",
    skill: "Bounds (error interval)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Mixed multi-step: percent then fraction (money) */
function makeMultiStepPercentThenFraction(){
  const pence = choice([1200, 1500, 1800, 2000, 2400, 3000, 3600, 4500]);
  const pct = choice([10, 20, 25, 50]);

  const newPence = (pence * (100 + pct)) / 100;
  const frac = choice([new Fraction(1,2), new Fraction(3,4), new Fraction(2,3)]);

  if((newPence * frac.n) % frac.d !== 0) return makeMultiStepPercentThenFraction();
  const paid = (newPence * frac.n) / frac.d;

  const question =
`A jacket costs ${moneyFromPence(pence)}.
It is increased by ${pct}%.
Then ${frac.toFractionString()} of the new price is paid using a voucher.
How much is paid after using the voucher?`;

  const correct = moneyFromPence(paid);
  const wrong1 = moneyFromPence(newPence); // ignored voucher
  const wrong2 = moneyFromPence(pence);    // ignored change
  const wrong3 = moneyFromPence((pence * frac.n) / frac.d); // took fraction of original

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeMultiStepPercentThenFraction();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Increase: ${moneyFromPence(pence)} × ${(100 + pct)}/100 = ${moneyFromPence(newPence)}
Pay ${frac.toFractionString()} of ${moneyFromPence(newPence)}:
= ${moneyFromPence(paid)}.`;

  return {
    id: makeID("MIX"),
    topic: "Number",
    skill: "Multi-step (percent + fraction)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* Mixed multi-step: share in a ratio (whole pounds) */
function makeMultiStepRatioShare(){
  const aPart = choice([2,3,4,5]);
  const bPart = choice([3,4,5,6,7]);
  const totalParts = aPart + bPart;

  const unit = choice([6,8,10,12,15,18,20]);
  const total = totalParts * unit;

  const shareA = aPart * unit;
  const shareB = bPart * unit;

  const question = `£${total} is shared between Ali and Ben in the ratio ${aPart} : ${bPart}.\nHow much does each person receive?`;

  const correct = `Ali £${shareA}, Ben £${shareB}`;
  const wrong1 = `Ali £${shareB}, Ben £${shareA}`; // swapped
  const wrong2 = `Ali £${shareA + unit}, Ben £${shareB - unit}`; // off by one unit
  const wrong3 = `Ali £${aPart}, Ben £${bPart}`; // used parts as pounds

  const answers = shuffleArray([correct, wrong1, wrong2, wrong3]);
  if(new Set(answers).size < 4) return makeMultiStepRatioShare();
  const correctIndex = answers.indexOf(correct);

  const solution =
`Total parts = ${aPart} + ${bPart} = ${totalParts}
One part = £${total} ÷ ${totalParts} = £${unit}
Ali = ${aPart} parts = ${aPart} × £${unit} = £${shareA}
Ben = ${bPart} parts = ${bPart} × £${unit} = £${shareB}`;

  return {
    id: makeID("MIX"),
    topic: "Number",
    skill: "Multi-step (ratio share)",
    difficulty: "Intermediate",
    question,
    options: answers,
    correctIndex,
    solution
  };
}

/* =========================
   Topic registry (NUMBER only active; others placeholder)
   Even distribution when topicSelect = all
   ========================= */

const NUMBER_TOPICS = [
  { key:"REV_PERCENT", name:"Reverse percentages", factories:[makeReversePercentMoney, makeReversePercentNumber] },
  { key:"PERCENT_CHANGE", name:"Percentage change", factories:[makePercentageChange] },
  { key:"RATIO_SIMPLIFY", name:"Ratio simplification", factories:[makeRatioSimplify] },
  { key:"BEST_BUY", name:"Best buy / unit pricing", factories:[makeBestBuy] },
  { key:"FRACTIONS", name:"Fraction calculations", factories:[makeFractionAddSub, makeFractionOfAmount] },
  { key:"INDICES", name:"Powers / indices", factories:[makeIndicesEvaluate] },
  { key:"MEAN", name:"Mean", factories:[makeMeanInteger] },
  { key:"STANDARD_FORM", name:"Standard form", factories:[makeStdFormConvert, makeStdFormMultiply, makeStdFormDivide] },
  { key:"BOUNDS", name:"Bounds", factories:[makeBoundsErrorInterval] },
  { key:"MIXED_MULTI_STEP", name:"Mixed multi-step", factories:[makeMultiStepPercentThenFraction, makeMultiStepRatioShare] }
];

let topicBag = [];
function refillTopicBag(){
  topicBag = shuffleArray(NUMBER_TOPICS.map(t => t.key));
}
function pickTopicEvenly(){
  if(topicBag.length === 0) refillTopicBag();
  return topicBag.pop();
}
function getNumberTopicByKey(key){
  return NUMBER_TOPICS.find(t => t.key === key);
}

/* =========================
   DOM + state
   ========================= */

let currentQuestion = null;

const topicSelect = document.getElementById("topicSelect");
const newQuestionBtn = document.getElementById("newQuestionBtn");
const showSolutionBtn = document.getElementById("showSolutionBtn");
const hideSolutionBtn = document.getElementById("hideSolutionBtn");

const questionTextEl = document.getElementById("questionText");
const optionsListEl = document.getElementById("optionsList");

const solutionBlockEl = document.getElementById("solutionBlock");
const solutionTextEl = document.getElementById("solutionText");

const topicTagEl = document.getElementById("topicTag");
const skillTagEl = document.getElementById("skillTag");
const difficultyTextEl = document.getElementById("difficultyText");
const idTagEl = document.getElementById("idTag");

function renderQuestion(q){
  topicTagEl.textContent = q.topic || "";
  skillTagEl.textContent = q.skill || "";
  difficultyTextEl.textContent = q.difficulty || "";
  idTagEl.textContent = q.id ? `ID: ${q.id}` : "";

  questionTextEl.textContent = q.question;

  optionsListEl.innerHTML = "";
  const labels = ["A", "B", "C", "D"];
  q.options.forEach((opt, index) => {
    const li = document.createElement("li");
    li.innerHTML = `<span class="option-label">${labels[index]}.</span> ${opt}`;
    optionsListEl.appendChild(li);
  });

  solutionTextEl.textContent = q.solution || "";
  solutionBlockEl.style.display = "none";
  hideSolutionBtn.disabled = true;
}

function generateQuestion(){
  const chosenTopic = topicSelect.value;

  // For now: only NUMBER is “live”/exam-complete. Other strands are placeholders.
  if(chosenTopic !== "all" && chosenTopic !== "Number"){
    questionTextEl.textContent = "This strand is not enabled yet. NUMBER is being completed first.";
    optionsListEl.innerHTML = "";
    solutionBlockEl.style.display = "none";
    topicTagEl.textContent = "";
    skillTagEl.textContent = "";
    difficultyTextEl.textContent = "";
    idTagEl.textContent = "";
    hideSolutionBtn.disabled = true;
    currentQuestion = null;
    return;
  }

  // Even distribution across NUMBER sub-topics when “all topics”
  const pickedKey = pickTopicEvenly();
  const pickedTopic = getNumberTopicByKey(pickedKey);

  const factory = choice(pickedTopic.factories);
  const q = factory();

  currentQuestion = q;
  renderQuestion(q);
}

newQuestionBtn.addEventListener("click", generateQuestion);

showSolutionBtn.addEventListener("click", () => {
  if(!currentQuestion) return;
  solutionBlockEl.style.display = "block";
  hideSolutionBtn.disabled = false;
});

hideSolutionBtn.addEventListener("click", () => {
  solutionBlockEl.style.display = "none";
  hideSolutionBtn.disabled = true;
});

// initialise
refillTopicBag();
topicTagEl.textContent = "";
skillTagEl.textContent = "";
difficultyTextEl.textContent = "";
idTagEl.textContent = "";
</script>
</body>
</html>
