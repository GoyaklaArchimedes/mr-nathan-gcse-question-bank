<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mr Nathan's GCSE Maths Question Bank</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; padding: 0; background: #f5f7fb; }
    .container { max-width: 900px; margin: 40px auto; background: #ffffff; padding: 24px 28px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    h1 { margin-top: 0; font-size: 1.6rem; color: #134b9b; }
    .subtitle { color: #555; margin-bottom: 16px; font-size: 0.95rem; }
    .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; align-items: center; }
    select, button { padding: 8px 12px; font-size: 0.95rem; border-radius: 4px; border: 1px solid #c5cbe0; background: #ffffff; cursor: pointer; }
    button { background: #134b9b; color: #fff; border: none; }
    button:hover { background: #0f3f84; }
    .meta { font-size: 0.9rem; color: #666; margin-bottom: 8px; }
    .question-text { font-size: 1.05rem; margin: 12px 0 16px; white-space: pre-wrap; }
    .options { list-style: none; padding: 0; margin: 0 0 16px; }
    .options li { margin-bottom: 6px; }
    .option-label { display: inline-block; width: 20px; font-weight: bold; }
    .solution { border-top: 1px solid #dde3f5; margin-top: 12px; padding-top: 12px; display: none; font-size: 0.95rem; }
    .solution pre { margin: 0; white-space: pre-wrap; font-family: inherit; }
    .difficulty { font-weight: bold; }
    .footer-note { margin-top: 20px; font-size: 0.8rem; color: #999; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #e7eefe; color: #134b9b; font-size: 0.75rem; margin-right: 6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mr Nathan's GCSE Maths Question Bank</h1>
    <div class="subtitle">Intermediate Tier • Random, regeneratable MCQs with full worked solutions.</div>

    <div class="controls">
      <label for="topicSelect">Topic:</label>
      <select id="topicSelect">
        <option value="all">(All topics)</option>
        <option value="Number">Number</option>
        <option value="Algebra">Algebra</option>
        <option value="Geometry & Measure">Geometry & Measure</option>
        <option value="Statistics & Probability">Statistics & Probability</option>
      </select>

      <button id="newQuestionBtn">New Question</button>
      <button id="showSolutionBtn">Show Solution</button>
    </div>

    <div class="meta">
      <span id="topicTag" class="pill"></span>
      <span id="skillTag" class="pill"></span>
      <span class="difficulty">Difficulty: <span id="difficultyText"></span></span>
    </div>

    <div class="question-text" id="questionText">Click “New Question” to begin.</div>
    <ul class="options" id="optionsList"></ul>

    <div class="solution" id="solutionBlock">
      <strong>Worked solution</strong>
      <pre id="solutionText"></pre>
    </div>

    <div class="footer-note">This is a growing question bank. Next goal: make Number fully exam-complete for WJEC GCSE Intermediate Tier.</div>
  </div>

  <script>
    // ---------- Utilities ----------
    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function shuffleArray(arr) {
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function buildMCQOptions(correctText, distractorTexts) {
      const all = [String(correctText), ...distractorTexts.map(String)];
      const shuffled = shuffleArray(all);
      return { options: shuffled, correctIndex: shuffled.findIndex(v => v === String(correctText)) };
    }

    function gcd(a, b) {
      a = Math.abs(a); b = Math.abs(b);
      while (b !== 0) { const t = b; b = a % b; a = t; }
      return a;
    }

    function simplifyFraction(n, d) {
      const g = gcd(n, d);
      return { n: n / g, d: d / g };
    }

    function sup(x) { return `<sup>${x}</sup>`; }

    function fractionToMixedString(n, d) {
      // assumes d>0
      const sign = n < 0 ? "-" : "";
      const absN = Math.abs(n);
      const whole = Math.floor(absN / d);
      const rem = absN % d;
      if (rem === 0) return sign + String(whole);
      if (whole === 0) return sign + `${rem}/${d}`;
      return sign + `${whole} ${rem}/${d}`;
    }

    function formatFractionOrMixed(n, d) {
      const simp = simplifyFraction(n, d);
      return fractionToMixedString(simp.n, simp.d);
    }

    function safeMoney(x) {
      return `£${(Math.round((x + Number.EPSILON) * 100) / 100).toFixed(2)}`;
    }

    // ---------- GCSE Standard Form helpers ----------
    function normaliseSci(coeff, power) {
      let c = coeff;
      let p = power;
      const EPS = 1e-12;

      while (c >= 10 - EPS) { c /= 10; p += 1; }
      while (c < 1 - EPS) { c *= 10; p -= 1; }

      // keep 1 dp (your preference) and re-check
      c = Math.round(c * 10) / 10;
      if (c >= 10) { c /= 10; p += 1; }

      return { coeff: c, power: p };
    }

    function sciHTML(coeff, power) {
      const norm = normaliseSci(coeff, power);
      const cStr = norm.coeff.toFixed(1); // 2.0 style
      return `${cStr} × 10${sup(norm.power)}`;
    }

    function coeffPowerToPlainDecimal(coeffStr, power) {
      // Build a decimal string WITHOUT e-notation
      const dotIndex = coeffStr.indexOf(".");
      const digitsBeforeDot = (dotIndex === -1) ? coeffStr.length : dotIndex;
      const digitsOnly = coeffStr.replace(".", "");
      const totalDigits = digitsOnly.length;

      const newDecimalPos = digitsBeforeDot + power;

      if (newDecimalPos >= totalDigits) {
        const zeros = "0".repeat(newDecimalPos - totalDigits);
        return digitsOnly + zeros;
      }
      if (newDecimalPos <= 0) {
        const zeros = "0".repeat(-newDecimalPos);
        return "0." + zeros + digitsOnly;
      }

      const left = digitsOnly.slice(0, newDecimalPos);
      const right = digitsOnly.slice(newDecimalPos).replace(/0+$/, "");
      return right.length ? (left + "." + right) : left;
    }

    // ---------- Templates ----------
    // NUMBER: Powers (fixed superscripts)
    function makePowersQuestion() {
      const b = [2,3,4,5,6,7,8,9][randInt(0,7)];
      const n = randInt(2,4);
      const correct = Math.pow(b, n);

      const { options, correctIndex } = buildMCQOptions(String(correct), [
        String(b * n),
        String(Math.pow(b, n - 1)),
        String(correct + b)
      ]);

      return {
        topic: "Number",
        skill: "Powers",
        difficulty: "Foundation / Core",
        questionHTML: `Evaluate: ${b}${sup(n)}`,
        optionsHTML: options,
        correctIndex,
        solutionHTML: `${b}${sup(n)} = ${correct}.`
      };
    }

    // NUMBER: Percentage of amount (prevents floating rubbish)
    function makePercentOfAmountQuestion() {
      const base = randInt(6, 60) * 5;
      const p = [5,10,12,15,20,25,30,35,40,45][randInt(0,9)];

      // exact rational: p/100 * base = (p*base)/100
      const num = p * base;
      const den = 100;
      const simp = simplifyFraction(num, den);
      const mixed = fractionToMixedString(simp.n, simp.d);

      const { options, correctIndex } = buildMCQOptions(mixed, [
        fractionToMixedString(...Object.values(simplifyFraction(base * 100, p))), // nonsense inverse
        String(base + p),                                                         // classic error
        String(Math.round((p/10)*base))                                           // /10 mistake
      ]);

      return {
        topic: "Number",
        skill: "Percentage of an amount",
        difficulty: "Foundation / Core",
        questionHTML: `Find ${p}% of ${base}.`,
        optionsHTML: options,
        correctIndex,
        solutionHTML:
          `${p}% of ${base} = ${p}/100 × ${base}\n` +
          `= ${p * base}/100 = ${mixed}`
      };
    }

    // NUMBER: Standard form (already GCSE, with superscripts + 2.0 style)
    function makeStandardFormQuestion() {
      const coeff = (randInt(12, 98) / 10);   // 1.2 .. 9.8
      const power = randInt(-4, 5);

      const coeffStr = coeff.toFixed(1);
      const ordinaryText = coeffPowerToPlainDecimal(coeffStr, power);
      const correctHTML = sciHTML(coeff, power);

      const d1 = sciHTML(coeff, -power);
      const d2 = sciHTML(coeff * 10, power);
      const d3 = sciHTML(coeff / 10, power);

      const distractors = Array.from(new Set([d1, d2, d3].filter(v => v !== correctHTML)));
      while (distractors.length < 3) distractors.push(sciHTML(randInt(12,98)/10, randInt(-6,6)));

      const { options, correctIndex } = buildMCQOptions(correctHTML, distractors.slice(0,3));

      // Special case: if the number is 2 (or any integer), still show standard form as 2.0 × 10^0
      // (This happens rarely with our generator, but the rule is now consistent.)
      return {
        topic: "Number",
        skill: "Standard form (convert)",
        difficulty: "Core / Intermediate",
        questionHTML: `Write ${ordinaryText} in standard form.`,
        optionsHTML: options,
        correctIndex,
        solutionHTML:
          `Standard form is a × 10ⁿ where 1 ≤ a < 10.\n` +
          `${ordinaryText} = ${correctHTML}`
      };
    }

    // STATS: Mean (now exact fraction/mixed number, no recurring decimals)
    function makeMeanQuestion() {
      const n = randInt(4, 6);
      const numbers = Array.from({length:n}, () => randInt(2, 15));
      const sum = numbers.reduce((a,b)=>a+b,0);

      // exact mean = sum/n
      const meanText = formatFractionOrMixed(sum, n);

      const { options, correctIndex } = buildMCQOptions(meanText, [
        String(sum),
        String(numbers[0]),
        String(numbers[numbers.length - 1])
      ]);

      return {
        topic: "Statistics & Probability",
        skill: "Mean",
        difficulty: "Foundation / Core",
        questionHTML: `The marks are: ${numbers.join(", ")}.\nWhat is the mean?`,
        optionsHTML: options,
        correctIndex,
        solutionHTML:
          `Sum = ${sum}\n` +
          `Mean = ${sum} ÷ ${n} = ${sum}/${n}\n` +
          `= ${meanText}`
      };
    }

    // ALGEBRA: simple linear equation (kept)
    function makeLinearEquationQuestion() {
      const a = randInt(2, 9);
      const x = randInt(-5, 8);
      const b = randInt(-10, 12);
      const c = a * x + b;

      const correct = x;
      const wrong1 = Math.round((c - b) / (a + 1));
      const wrong2 = c - b;
      const wrong3 = Math.round((c + b) / a);

      const { options, correctIndex } = buildMCQOptions(String(correct), [
        String(wrong1),
        String(wrong2),
        String(wrong3)
      ]);

      return {
        topic: "Algebra",
        skill: "Solving linear equations",
        difficulty: "Core / Intermediate",
        questionHTML: `Solve: ${a}x + (${b}) = ${c}`,
        optionsHTML: options,
        correctIndex,
        solutionHTML:
          `${a}x = ${c} - (${b}) = ${c - b}\n` +
          `x = ${c - b} ÷ ${a} = ${correct}`
      };
    }

    // GEOMETRY: area of rectangle (kept)
    function makeRectangleAreaQuestion() {
      const length = randInt(4, 20);
      const width = randInt(3, 15);
      const correct = length * width;

      const { options, correctIndex } = buildMCQOptions(`${correct} cm²`, [
        `${length + width} cm²`,
        `${2 * (length + width)} cm²`,
        `${length * length} cm²`
      ]);

      return {
        topic: "Geometry & Measure",
        skill: "Area of a rectangle",
        difficulty: "Foundation",
        questionHTML: `A rectangle has length ${length} cm and width ${width} cm. What is its area?`,
        optionsHTML: options,
        correctIndex,
        solutionHTML: `Area = ${length} × ${width} = ${correct} cm²`
      };
    }

    // ---------- Topic pools (for even topic frequency) ----------
    const pools = {
      "Number": [makePowersQuestion, makePercentOfAmountQuestion, makeStandardFormQuestion],
      "Algebra": [makeLinearEquationQuestion],
      "Geometry & Measure": [makeRectangleAreaQuestion],
      "Statistics & Probability": [makeMeanQuestion]
    };

    function pickFromPool(topic) {
      const arr = pools[topic];
      return arr[randInt(0, arr.length - 1)]();
    }

    function generateQuestionByTopicSelection(selectedTopic) {
      if (selectedTopic !== "all") {
        return pickFromPool(selectedTopic);
      }
      // Choose topic uniformly so topics appear evenly
      const topics = Object.keys(pools);
      const t = topics[randInt(0, topics.length - 1)];
      return pickFromPool(t);
    }

    // ---------- App wiring ----------
    let currentQuestion = null;

    const topicSelect = document.getElementById("topicSelect");
    const newQuestionBtn = document.getElementById("newQuestionBtn");
    const showSolutionBtn = document.getElementById("showSolutionBtn");
    const questionTextEl = document.getElementById("questionText");
    const optionsListEl = document.getElementById("optionsList");
    const solutionBlockEl = document.getElementById("solutionBlock");
    const solutionTextEl = document.getElementById("solutionText");
    const topicTagEl = document.getElementById("topicTag");
    const skillTagEl = document.getElementById("skillTag");
    const difficultyTextEl = document.getElementById("difficultyText");

    function renderQuestion(q) {
      topicTagEl.textContent = q.topic;
      skillTagEl.textContent = q.skill;
      difficultyTextEl.textContent = q.difficulty;

      questionTextEl.innerHTML = q.questionHTML;

      optionsListEl.innerHTML = "";
      const labels = ["A", "B", "C", "D"];
      q.optionsHTML.forEach((opt, index) => {
        const li = document.createElement("li");
        li.innerHTML = `<span class="option-label">${labels[index]}.</span> ${opt}`;
        optionsListEl.appendChild(li);
      });

      solutionTextEl.innerHTML = q.solutionHTML;
      solutionBlockEl.style.display = "none";
    }

    function generateQuestion() {
      const chosenTopic = topicSelect.value;
      currentQuestion = generateQuestionByTopicSelection(chosenTopic);
      renderQuestion(currentQuestion);
    }

    newQuestionBtn.addEventListener("click", generateQuestion);
    showSolutionBtn.addEventListener("click", () => { if (currentQuestion) solutionBlockEl.style.display = "block"; });
  </script>
</body>
</html>
